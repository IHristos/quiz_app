<!-- templates/results.html -->

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Your Quiz Results</title>
    <link rel="stylesheet" href="/static/style.css" />
  </head>
  <body>
    <button
      id="darkModeToggle"
      style="position: fixed; top: 20px; right: 20px; z-index: 1000"
    >
      üåô Dark Mode
    </button>
    <script>
      const toggleBtn = document.getElementById("darkModeToggle");
      const body = document.body;
      let dark = false;
      toggleBtn.onclick = function () {
        dark = !dark;
        if (dark) {
          body.classList.add("dark-mode");
          toggleBtn.textContent = "‚òÄÔ∏è Light Mode";
        } else {
          body.classList.remove("dark-mode");
          toggleBtn.textContent = "üåô Dark Mode";
        }
        localStorage.setItem("darkMode", dark ? "1" : "0");
      };
      // Persist mode
      if (localStorage.getItem("darkMode") === "1") {
        body.classList.add("dark-mode");
        toggleBtn.textContent = "‚òÄÔ∏è Light Mode";
        dark = true;
      }
    </script>
    <div class="container">
      <h1>Quiz Complete!</h1>
      <p>
        You got <strong>{{ score }}</strong> out of
        <strong>{{ results|length }}</strong> correct ‚Äî that's
        <strong>{{ percent }}%</strong> üéØ
      </p>

      {% for r in results %}
      <div class="result-block">
        <h3>
          Question {{ loop.index }} {% if r.multi %}<em
            >(choose multiple answers)</em
          >{% endif %}
        </h3>
        <p>{{ r.question }}</p>
        <ul>
          {% for a in r.answers %}
          <li>
            {% if a.is_selected and a.is_correct %} ‚úÖ
            <strong>{{ a.text }}</strong>
            <span style="color: green">(your answer & correct)</span> {% elif
            a.is_selected and not a.is_correct %} ‚ùå
            <strong>{{ a.text }}</strong>
            <span style="color: red">(your answer & incorrect)</span> {% elif
            a.is_correct %} ‚úÖ <strong>{{ a.text }}</strong>
            <span style="color: blue">(correct but not selected)</span>
            {% else %} {{ a.text }} {% endif %}
          </li>
          {% endfor %}
        </ul>
        <div style="font-size: 0.9em; color: #888; margin-bottom: 10px">
          <strong>Debug info:</strong><br />
          Selected (normalized): {{ r.selected|join(', ') }}<br />
          Correct (normalized): {{ r.correct|join(', ') }}
        </div>
        <p style="color: {{ 'green' if r.is_fully_correct else 'red' }};">
          {% if r.is_fully_correct %}‚úîÔ∏è Correct!{% else %}‚ùå Incorrect.{% endif
          %}
        </p>
        <hr />
      </div>
      {% endfor %}

      <a href="/retake">
        <button style="padding: 10px 20px; font-size: 1em">
          üîÅ Retake the Quiz
        </button>
      </a>
    </div>
  </body>
</html>
